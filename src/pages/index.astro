---
import { getEntry } from 'astro:content'
import Markdown from '@components/misc/Markdown.astro'
import { Icon } from 'astro-icon/components'
import ContentCard from '../components/ContentCard.astro'
import PostMetadata from '../components/PostMeta.astro'
import PostPage from '../components/PostPage.astro'
import MainGridLayout from '../layouts/MainGridLayout.astro'
import { getSortedPosts } from '../utils/content-utils'

// 获取排序后的文章列表
const allPosts = await getSortedPosts()
const posts = allPosts.slice(0, 5)
const aboutPost = await getEntry('spec', 'index')
const { Content } = await aboutPost.render()
---

<MainGridLayout>
    <ContentCard 
        class="onload-animation" 
        style="animation-delay: var(--content-delay)"
    />
    <div class="flex w-full rounded-[var(--radius-large)] overflow-hidden relative min-h-32 mb-4">
        <div class="card-base z-10 px-9 py-6 relative w-full">
            <Markdown class="mt-2">
                <Content />
            </Markdown>
        </div>
    </div>

    <!-- 最新文章列表卡片 -->
    <div class="flex w-full rounded-[var(--radius-large)] overflow-hidden relative mt-4">
        <div class="card-base z-10 px-9 py-6 relative w-full">
            <h2 class="text-xl font-bold text-black/90 dark:text-white/90 mb-4">最新文章</h2>
            <div class="divide-y divide-gray-200 dark:divide-gray-700">
    {posts.map((post) => (
        <article class="py-4">
            <div class="flex items-center gap-2 mb-2 group">
                <div class="transition h-6 w-6 rounded-md overflow-hidden 
                    bg-[var(--primary)] relative
                    flex items-center justify-center">
                    <!-- 半透明遮罩层 -->
                    <div class="absolute -inset-1 bg-white/70 dark:bg-black/70 rounded-md overflow-hidden"></div>
                    
                    <!-- 图标 -->
                    <Icon name="material-symbols:notes-rounded" 
                        class="text-xl text-[var(--primary)] relative z-10"/>
                </div>
                <a href={`/posts/${post.slug}/`} class="text-black/75 dark:text-white/75 hover:text-[var(--primary)] dark:hover:text-[var(--primary)] transition-colors">
                    <h3 class="text-lg font-medium">{post.data.title}</h3>
                </a>
            </div>
            <PostMetadata 
                published={post.data.published}
                updated={post.data.updated}
                tags={post.data.tags}
                category={post.data.category}
                hideTagsForMobile={true}
                hideUpdateDate={true}
                class="ml-8"
            />
        </article>
    ))}
</div>
        </div>
    </div>
</MainGridLayout>